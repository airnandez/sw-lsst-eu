SPHINX_VERSION = 7.1.2
DOCKER_IMAGE = $(shell whoami)/sphinx_rtd_theme:$(SPHINX_VERSION)

all: preview

dockerimage: Dockerfile
	docker buildx build --tag $(DOCKER_IMAGE) .

preview: build
	open _build/index.html

build: dockerimage
	docker run --rm --volume $(shell pwd):/docs $(DOCKER_IMAGE) sphinx-build -a -E -b html source _build

clean:
	rm -rf _build
	docker image rm $(DOCKER_IMAGE)

help:
	@printf "Usage: make <target>\n\n   where <target> may be one of:\n\n"
	@printf "   %-12s %s\n" "dockerimage" "to build the Docker image"
	@printf "   %-12s %s\n" "preview" "to build and locally preview the resulting web site"
	@printf "   %-12s %s\n" "build" "to build the web site"
	@printf "   %-12s %s\n" "clean" "to delete the files generated by Sphinx"